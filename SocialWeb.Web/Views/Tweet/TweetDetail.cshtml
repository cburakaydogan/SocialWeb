@model TweetDetailVm

@{
    ViewData["Title"] = "TweetDetail";
}
<div class="panel">
    <div class="panel-heading">
        <h3 class="panel-title">Tweet Details</h3>
    </div>
    <div class="panel-content panel-activity" style="padding-top: 10px">
        
        <ul class="panel-activity__list" style="margin-top: 0px">
                <li>
                    <i class="activity__list__icon fa fa-question-circle-o"></i>
                    <div class="activity__list__header">
                        <img src="@Model.UserImage" alt="" />
                        <a asp-controller="Profile" asp-action="Detail" asp-route-userName="@Model.UserName">@Model.Name</a> @@@Model.UserName
                    </div>
                    <div class="activity__list__body entry-content">
                        <p>
                            @Model.Text
                        </p>
                    </div>
                    <div class="activity__list__footer">
                         @if (Model.isLiked)
                        {
                            <a onclick="Unlike(@Model.Id)" id="@Model.Id"> <i class="fa fa-heart"></i><span id="likecount_@Model.Id">@Model.LikesCount</span></a>
                        }
                        else{
                            <a onclick="Like(@Model.Id)" id="@Model.Id"> <i class="fa fa-heart-o"></i><span id="likecount_@Model.Id">@Model.LikesCount</span></a>
                        }
                        <a> <i class="fa fa-comments"></i>@Model.MentionsCount</a>
                        <a> <i class="fa fa-share"></i>@Model.SharesCount</a>
                        <span> <i class="fa fa-clock"></i>@Model.CreateDate</span>
                    </div> </li>
                    <div style="margin-top: 20px">
              @foreach (var item in Model.Mentions)
                {
                     
                    <li style="margin-top: 10px; font-size:14px"><div class="comment_header">
                        <img src="@item.UserImage" alt="" />
                        <a asp-controller="Profile" asp-action="Detail" asp-route-userName="@item.UserName">@item.Name</a> @@@item.UserName
                          <span class="pull-right"> <i class="fa fa-clock"></i>@Model.CreateDate</span>
                    </div>
                    <div class="comment_body">
                        <p>
                            @item.Text
                        </p>
                    </div></li>
                }</div>
             
        </ul>

    </div>
</div>

<script>

         function Like(id) {
            let $likecount = $("#likecount_"+id);
            let likecount = Number($likecount.val() + $likecount.next().text()) || 0;
            
            var model={
                TweetId: id,
                AppUserId: 0};
            console.log(likecount);
            $.ajax({
            data: JSON.stringify(model),
            type: "POST",
            url: "/Like/Like/",
            contentType: "application/json",
            dataType: "JSON",
            success: function (result) {
                if(result=="Success"){
                    likecount= likecount+1;
                   let html = '<a onclick="Unlike('+id+')"id="'+id+'"><i class="fa fa-heart"></i><span id="likecount'+id+'">'+likecount+'</span></a>';

                    $( "#"+id ).replaceWith(html);
                }
                    }
            });}
           function Unlike(id) {
            let $likecount = $("#likecount_"+id);
            let likecount = Number($likecount.val() + $likecount.next().text()) || 0;
            var model={
                TweetId: id,
                AppUserId: 0};
            $.ajax({
            data: JSON.stringify(model),
            type: "POST",
            url: "/Like/Unlike/",
            contentType: "application/json",
            dataType: "JSON",
            success: function (result) {
                if(result=="Success"){
                     
                     if(likecount!=0)
                    likecount= likecount-1;
                    
                   let html = '<a onclick="Like('+id+')"id="'+id+'"><i class="fa fa-heart-o"></i><span id="likecount'+id+'">'+likecount+'</span></a>';

                    $( "#"+id ).replaceWith(html);
                    }

                    }
            });}
</script>
                